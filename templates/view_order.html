{% extends "base.html" %}

{% block title %}View Order - VAPA Order System{% endblock %}

{% block content %}
<div class="section-header">
    <h2>ðŸ“¦ Order Details</h2>
    <div class="button-group">
        <a href="{{ url_for('edit_order', order_id=order.id) }}" class="btn btn-primary">Edit Order</a>
    </div>
</div>

<div class="order-info">
    <h3>{{ order.vendor }}</h3>
    <p><strong>Teacher:</strong> {{ order.teacher.full_name }}</p>
    <p><strong>Created:</strong> {{ order.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
    {% if order.updated_at != order.created_at %}
    <p><strong>Last Updated:</strong> {{ order.updated_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
    {% endif %}
</div>

<div class="section">
    <h3>Items</h3>
    {% if order.items %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Catalog #</th>
                <th>Description</th>
                <th class="text-center">Quantity</th>
                <th class="text-right">Unit Cost</th>
                <th class="text-right">Total</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.items %}
            <tr>
                <td>{{ item.catalog_number or '-' }}</td>
                <td>{{ item.description or '-' }}</td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-right">${{ "{:.2f}".format(item.unit_cost) }}</td>
                <td class="text-right">${{ "{:.2f}".format(item.total_cost) }}</td>
                <td>{{ item.category.replace('&', ' & ') if item.category else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="4" class="text-right"><strong>Order Total:</strong></td>
                <td class="text-right"><strong>${{ "{:.2f}".format(order.items|sum(attribute='total_cost')) }}</strong></td>
                <td></td>
            </tr>
        </tfoot>
    </table>
    {% else %}
    <div class="empty-state">
        <p>No items in this order yet.</p>
        <a href="{{ url_for('edit_order', order_id=order.id) }}" class="btn btn-primary">Add Items</a>
    </div>
    {% endif %}
</div>

<div class="section">
    <h3>Category Breakdown</h3>
    <table class="data-table">
        <thead>
            <tr>
                <th>Category</th>
                <th class="text-right">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for category, amount in category_totals.items() %}
            {% if amount > 0 %}
            <tr>
                <td>{{ category.replace('&', ' & ') }}</td>
                <td class="text-right">${{ "{:.2f}".format(amount) }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="button-group">
    <a href="{{ url_for('edit_order', order_id=order.id) }}" class="btn btn-primary">Edit Order</a>
    <form method="POST" action="{{ url_for('delete_order', order_id=order.id) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this order?');">
        <button type="submit" class="btn btn-danger">Delete Order</button>
    </form>
</div>

<div class="back-link">
    <a href="{{ url_for('dashboard') }}">&larr; Back to Dashboard</a>
</div>
{% endblock %}
