{% extends "base.html" %}

{% block title %}Dashboard - VAPA Order System{% endblock %}

{% block content %}
<h2>Welcome, {{ session.full_name }}!</h2>

<div class="section">
    <div class="section-header">
        <h3>ðŸ“‹ Your Orders</h3>
        <a href="{{ url_for('new_order') }}" class="btn btn-primary">+ New Order</a>
    </div>
    
    {% if orders %}
    <div class="orders-grid">
        {% for order in orders %}
        <div class="order-card">
            <h4>{{ order.vendor }}</h4>
            <p class="order-meta">
                Created: {{ order.created_at.strftime('%B %d, %Y') }}<br>
                Items: {{ order.items|length }}
            </p>
            <p class="order-total">
                Total: ${{ "{:,.2f}".format(order.items|sum(attribute='total_cost')) }}
            </p>
            <div class="button-group">
                <a href="{{ url_for('view_order', order_id=order.id) }}" class="btn btn-secondary btn-sm">View</a>
                <a href="{{ url_for('edit_order', order_id=order.id) }}" class="btn btn-primary btn-sm">Edit</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <p>ðŸ“¦ You haven't created any orders yet.</p>
        <a href="{{ url_for('new_order') }}" class="btn btn-primary">Create Your First Order</a>
    </div>
    {% endif %}
</div>

<div class="section">
    <h3>ðŸ’° Your Category Totals</h3>
    <table class="data-table">
        <thead>
            <tr>
                <th>Category</th>
                <th class="text-right">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for category, amount in category_totals.items() %}
            <tr>
                <td>{{ category.replace('&', ' & ') }}</td>
                <td class="text-right">${{ "{:,.2f}".format(amount) }}</td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td><strong>TOTAL</strong></td>
                <td class="text-right"><strong>${{ "{:,.2f}".format(category_totals.values()|sum) }}</strong></td>
            </tr>
        </tfoot>
    </table>
</div>
{% endblock %}
